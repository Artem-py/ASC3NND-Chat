<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Photon Private Chat</title>
<style>
body { font-family: Arial; background:#111; color:white; text-align:center; }
#chat { 
    width: 90%; 
    height: 300px; 
    margin: 10px auto; 
    border:1px solid #444; 
    overflow-y: auto; 
    padding:10px; 
    background:#1e1e1e;
}
input, button {
    padding:10px;
    margin:5px;
    border:none;
    border-radius:5px;
}
button { cursor:pointer; }
.user { color:#00ffcc; }
.system { color:gray; }
</style>
</head>
<body>

<h2>Photon Private Chat</h2>

<div id="login">
    <input id="username" placeholder="Введите ник">
    <button onclick="connect()">Подключиться</button>
</div>

<div id="chatUI" style="display:none;">
    <div id="chat"></div>
    <input id="targetActor" placeholder="ActorNumber друга">
    <input id="message" placeholder="Сообщение">
    <button onclick="sendMessage()">Отправить</button>
</div>

<script src="https://unpkg.com/@photonengine/photon-javascript-sdk/dist/Photon.min.js"></script>

<script>

var appId = "42a1ae68-f580-445a-9b4e-5c90dd615a89"; // ВСТАВЬ СЮДА СВОЙ APP ID
var client;

function log(text, className="") {
    var chat = document.getElementById("chat");
    chat.innerHTML += "<div class='"+className+"'>" + text + "</div>";
    chat.scrollTop = chat.scrollHeight;
}

function connect() {

    var username = document.getElementById("username").value;
    if (!username) return alert("Введите ник");

    client = new Photon.LoadBalancing.LoadBalancingClient(
        Photon.ConnectionProtocol.Wss,
        appId,
        "1.0"
    );

    client.myActor().setName(username);

    client.onStateChange = function(state) {
        if (state === Photon.LoadBalancing.LoadBalancingClient.State.Joined) {
            log("Вы подключились. Ваш ActorNumber: " + client.myActor().actorNr, "system");
        }
    };

    client.onEvent = function(code, content, actorNr) {
        if (code === 1) {
            log("Сообщение от " + actorNr + ": " + content.text, "user");
        }
    };

    client.onRoomList = function() {};

    client.onActorJoin = function(actor) {
        log("Игрок зашел: " + actor.actorNr, "system");
    };

    client.onActorLeave = function(actor) {
        log("Игрок вышел: " + actor.actorNr, "system");
    };

    client.connectToRegionMaster("eu");

    client.onStateChange = function(state) {
        if (state === Photon.LoadBalancing.LoadBalancingClient.State.ConnectedToMaster) {
            client.joinRoom("mainRoom") || client.createRoom("mainRoom");
        }
        if (state === Photon.LoadBalancing.LoadBalancingClient.State.Joined) {
            document.getElementById("login").style.display="none";
            document.getElementById("chatUI").style.display="block";
            log("Вы в комнате mainRoom", "system");
            log("Ваш ActorNumber: " + client.myActor().actorNr, "system");
        }
    };
}

function sendMessage() {

    var text = document.getElementById("message").value;
    var target = parseInt(document.getElementById("targetActor").value);

    if (!text || !target) return alert("Введите ActorNumber и сообщение");

    client.raiseEvent(
        1,
        { text: text },
        { targetActors: [target] }
    );

    log("Вы -> " + target + ": " + text);
    document.getElementById("message").value="";
}

</script>

</body>
</html>
